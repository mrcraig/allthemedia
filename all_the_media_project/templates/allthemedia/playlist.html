<html>
 <!----
	playlist(request, user_name_url, playlist_title_url)
	returns:
	user: user (creator of the playlist)
	user_name_url : username derived from url
	playlist: the playlist you are trying to view
	media: list of media in playlist

   ---->
  <head>
	<title>Playlist - {{ playlist.title }}</title>
  </head>


  <body>

    <h1>Playlist - {{ playlist.title }}</h1>

	<p></p>

  <body>

    <script type="text/javascript">
        var vids = [];
        var vidCount = 0;
        var m;
    </script>

    <div id="player"></div>
    
    {% if media %}
    
	<ul>
	{% for m in media %}
        <script>
            m = "{{ m.url }}";
            vids[vidCount] = m;
            vidCount++;
        </script>
	{% endfor %}

    <div id="player"></div>
              
              <script>
        
              // 2. This code loads the IFrame Player API code asynchronously.
              var tag = document.createElement('script');

              // This is a protocol-relative URL as described here:
              //     http://paulirish.com/2010/the-protocol-relative-url/
              // If you're testing a local page accessed via a file:/// URL, please set tag.src to
              //     "https://www.youtube.com/iframe_api" instead.
              tag.src = "https://www.youtube.com/iframe_api";
              var firstScriptTag = document.getElementsByTagName('script')[0];
              firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

              vidCount = 0;
              var video_id;
              getVidID();

              // 3. This function creates an <iframe> (and YouTube player)
              //    after the API code downloads.
              var player;
              function onYouTubeIframeAPIReady() {
                player = new YT.Player('player', {
                  height: '390',
                  width: '640',
                  videoId: video_id,
                  events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                  }
                });
              }
               
              // 4. The API will call this function when the video player is ready.
              function onPlayerReady(event) {
                event.target.playVideo();
              }
            
              function stopVideo() {
                player.stopVideo();
              }
              // 5. The API calls this function when the player's state changes.
              function onPlayerStateChange(event) {
                if (event.data == YT.PlayerState.ENDED) {
                    nextVid();
                }
              }

              function nextVid() {
                vidCount++;
                if (vidCount >= (vids.length)){
                    vidCount = 0;
                }
                getVidID();
                player.loadVideoById(video_id);
              }

              function prevVid() {
                vidCount--;
                if (vidCount < 0){
                    vidCount = vids.length-1;
                }
                getVidID();
                player.loadVideoById(video_id);
              }
            
              function getVidID(){
                video_id = vids[vidCount].split('v=')[1];
                var ampersandPosition = video_id.indexOf('&');
                if(ampersandPosition != -1) {
                    video_id = video_id.substring(0, ampersandPosition);
                }
              }

              </script>

              <button onclick=prevVid()>Back</button>
              <button onclick=nextVid()>Next</button>

	</ul>

	{% else %}
	No media in playlist
	{% endif %}

  </body>
</html>
