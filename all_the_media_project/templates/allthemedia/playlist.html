<html>
  <head>
	<title>Playlist - {{ playlist_title }}</title>
  </head>

    <h1>Playlist - {{ playlist_title }}</h1>
	<p></p>

  <body>

    <script type="text/javascript">
        var vids = [];
        var vidCount = 0;
        var m;
    </script>
    
    {% if media %}
	<ul>
	{% for m in media %}
        <script>
            m = "{{ m.url }}";
            vids[vidCount] = m;
            vidCount++;
        </script>
	<li><a href="{{ m.url }}">{{ m.name }}</a></li>
	{% endfor %}
	</ul>
	{% else %}
	No media in playlist
	{% endif %}

    <div id="player"></div>
              
              <script>
        
              // 2. This code loads the IFrame Player API code asynchronously.
              var tag = document.createElement('script');

              // This is a protocol-relative URL as described here:
              //     http://paulirish.com/2010/the-protocol-relative-url/
              // If you're testing a local page accessed via a file:/// URL, please set tag.src to
              //     "https://www.youtube.com/iframe_api" instead.
              tag.src = "https://www.youtube.com/iframe_api";
              var firstScriptTag = document.getElementsByTagName('script')[0];
              firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

              vidCount = 0;
              var video_id = vids[vidCount].split('v=')[1];
              var ampersandPosition = video_id.indexOf('&');
              if(ampersandPosition != -1) {
                 video_id = video_id.substring(0, ampersandPosition);
              }

              // 3. This function creates an <iframe> (and YouTube player)
              //    after the API code downloads.
              var player;
              function onYouTubeIframeAPIReady() {
                player = new YT.Player('player', {
                  height: '390',
                  width: '640',
                  videoId: video_id,
                  events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                  }
                });
              }

              // 4. The API will call this function when the video player is ready.
              function onPlayerReady(event) {
                event.target.playVideo();
              }
            
              function stopVideo() {
                player.stopVideo();
              }
              // 5. The API calls this function when the player's state changes.
              function onPlayerStateChange(event) {
                
                if (event.data == YT.PlayerState.ENDED) {
                    vidCount++;
                    video_id = vids[vidCount].split('v=')[1];
                    var ampersandPosition = video_id.indexOf('&');
                    if(ampersandPosition != -1) {
                        video_id = video_id.substring(0, ampersandPosition);
                    }
                    player.loadVideoById(video_id);
                }
              }
              
    </script>



	
  </body>
</html>
